###  TCP 的三次握手与四次挥手过程，各个状态名称与含义

#### 三次握手

  第一次握手：客户机首先向服务器的 TCP 发送一个连接请求报文段，这个特殊的报文段不含应用层数据，其首部中同步位 SYN 被设置为 1。另外，客户机会随机选择一个起始序号 seq=x(连接请求报文不携带数据，但要消耗一个序号).
  第二次握手：服务器的 TCP 收到连接请求报文段后，如果同意建立连接，就向客户机发回确认，并为该 TCP 连接分配 TCP 缓存和变量。在确认报文段中，SYN 和 ACK 位都被设置为 1，确认号字段值为 ack=x+1, 并且服务器随机产生起始序号 seq=y. 确认包同样不包含应用层数据。
  第三次握手：当客户机收到确认报文段后，还要向服务器给出确认，并且也要给该连接分配缓存和变量。这个报文段的确认为 ACK 被设置为 1，序号段被设置为 seq=x+1, 确认号字段 ack=y+1. 该报文段可以携带数据，如果不携带数据则不消耗序号。 理想状态下，TCP 连接一旦建立，在通信双方中的任何一方主动关闭连接之前，TCP 连接都将被一直保持下去。因为 TCP 提供全双工通信，因此双方任何时候都可以发送数据。

#### 四次挥手

  第一次挥手：客户机打算关闭连接，就向其 TCP 发送一个连接释放报文，并停止再发送数据，主动关闭 TCP 连接。该报文段的 FIN 标志位被设置为 1，seq=u, 它等于前面已经发送过的数据的最后一个字节的序号加 1。
  第二次挥手：服务器收到连接释放报文段后即发出确认，确认号是 ack=u+1, 序号为 v, 等于它前面已经发送过的数据的最后一个字节序号加 1. 此时客户机到服务器这个方向的连接就释放了，TCP 处于半关闭状态。ACK=1，seq=v,ack=u+1
  第三次挥手：若服务器已经没有要向客户机发送的数据，就通知 TCP 释放连接，此时发出 FIN=1，确认号 ack= u+1, 序号 seq =w, 已经发送过的数据最后一个字节加 1。确认为 ACK=1. (FIN = 1, ACK=1,seq = w, ack =u+1)
  第四次挥手：客户机收到连接释放报文段后，必须发出确认。在确认报文段中，确认位 ACK=1，序号 seq=u+1, 确认号 ack=w+1. 此时连接还没有释放掉，必须经过实践等待计时器设置的时间 2MSL(Max Segment Lifetime), 后，客户机才进入连接关闭状态。 (ACK=1,seq=u+1,ack=w+1)